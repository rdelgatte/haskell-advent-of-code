{-# LANGUAGE ScopedTypeVariables #-}

module Day3Spec where

import Data.Text
import Day3
import Test.Tasty.HUnit (testCase, (@?=))

input :: [String]
input =
  [ ".#.......#...........#.........",
    "..##.......#.#.#.....##...#....",
    ".......#..#.....#...#..........",
    "...#..........###...#........##",
    "#.#..#.#.##.#........#.#.....#.",
    "#..#....#..#....#..............",
    "#..#........#..................",
    "..#.#...#.#...#....#.#.#..#....",
    "..............#..#.............",
    ".##....#...................#...",
    "........#..........#......#...#",
    ".##..#..#...##..........#...#..",
    ".#...#....#.........#...#.....#",
    ".#........##............#.#....",
    "...........#..............##...",
    ".#..#......#..#..............#.",
    "..#.#.#...........#........#...",
    "..###..........#....#.#......#.",
    ".......#...##..........#.......",
    "........#...#..................",
    "....#....#..#.......#........#.",
    ".......##.#......#.....#...##..",
    "..#.#........................#.",
    ".#.....#.##..............#.#...",
    "..#.#...#.#..#....#....#.......",
    ".#....##.....#....#........#...",
    "..#...........#.##....#...#....",
    "..#.##...#....#.#.....##...#...",
    ".......#...####...#...#.......#",
    ".#...#.........................",
    ".......................#.......",
    ".....#.#.........#..........#.#",
    "#.........#............###..#..",
    ".....#.#.............###.......",
    "...#..#........#.#.......#.....",
    "...................#....#......",
    "...#..#...#............#..##...",
    "...#.....#....#.......##......#",
    ".....#....#...##..#..#...#...#.",
    "..........#...........#.#.#....",
    "..#.......#...#.....#......#...",
    ".........#.......##......#..#.#",
    "..#.....#..#.###...#.#......#..",
    "#....#...#..#...#.....#........",
    "..#......#..#.......#.#.....#..",
    "#......#...#......#.....##.#...",
    "........##.......#.......#.....",
    ".#.#...............#...........",
    "..............#...#.#....#.....",
    "....#......#.#..#......#.......",
    "...##....#....#...#............",
    ".#...............#...........#.",
    ".#.#...#.#.....#.....#...#.#...",
    "...##...........#.....#..#...#.",
    ".#.#...##.#.#......#......#....",
    ".##.....#.......##....#.#.#....",
    ".......#...........#....#....#.",
    "....#...........#......#.####..",
    "......#....#...#...##.......#..",
    "......................#.#####..",
    "..#...#.#...#..#..#......#.....",
    "....#........##.......##....#..",
    "#.#......##.........##.#..#...#",
    ".#.#....#...#..#...#...##....#.",
    ".....##...#....#....#.#........",
    "......#..#....#.#...#..........",
    ".........#...................#.",
    "............#.###....#.#.......",
    "...#.#.....#......#....#.#..#..",
    "..............#..#.#.#.#.......",
    "#..##...................##.....",
    "..#.......#..#.........##..#...",
    ".........##...#......#........#",
    "..#.........#........##.###.#..",
    "...........#.#....#.....###....",
    "..#....##.#..#.##....#.....##..",
    "..#.....#.##..................#",
    "#....#.........................",
    "..............#..#...#.#.......",
    "......#..#.#.##....#..........#",
    "..#.........#.####.....#.......",
    "......#..#.#..........#...#....",
    "......#.................#..#.#.",
    ".....#..........#..............",
    "....#.....#............#....##.",
    ".....#.....#........#..........",
    "............#.....#...#........",
    "........#....#.#...............",
    "#.....#.........#......#..#.#..",
    "...#..#......#......#.......#..",
    ".....#......#.#....#..#...#...#",
    "......................#..##....",
    ".............#.........###....#",
    "#..............#.#..........##.",
    "...#.#.................##......",
    "...........#.#.....#...........",
    ".........#.................#.#.",
    "........#........#...#..##...#.",
    "........#......##.......###....",
    "..............#.#.#............",
    ".#.....###...##.#......#.....#.",
    ".............#......#.#.#...#.#",
    "..#.........#.......#.....#....",
    "......#........#...##......#...",
    ".##..........##......#.#.....#.",
    "..#.##....#....#...............",
    "......#...#..#.....#.....#...#.",
    ".......##..##..#............##.",
    "..............#...##........#..",
    "#....#................#..#.....",
    "........#.......#.#.#...#......",
    "......#.......#..............#.",
    "#.#..#...#........#....#..####.",
    "..#........#...........#.....#.",
    ".##...........................#",
    ".............#...........#.....",
    ".#.....#.#...#.........#.......",
    "..........#...#....#....#......",
    ".#..#........##....#...........",
    ".......###......##...#.........",
    "..........#.#.#..#.#....#......",
    "........##..#.........#....#...",
    "........#.#......#.#...#.#..#..",
    "....#....................#.##..",
    "##....#..#...........#.....#.#.",
    "...#..............##...##..#.#.",
    "......#.##.#.......#..#...#....",
    "....#..#..##.....#.....#.#....#",
    ".......#....##.##..............",
    "#..##....#.....#.#.............",
    "..................#......#..#..",
    "..#......#...#..#.......#...#..",
    "...........#....#.#.....#......",
    "#..#...##.........###..#......#",
    ".......#......................#",
    "#.......#....................#.",
    "..#..#..........#..#..#....#...",
    ".##..#..#.....#.#..##..........",
    "#..###.......#..##..#...#..#.#.",
    ".....##......###.....#.#.##...#",
    "..............#...#....#.#.....",
    "#...........#..................",
    "..............#....#..##..#..#.",
    ".........#.............#.......",
    ".#.#....#....#...............##",
    ".##.##.#.....###.....#.........",
    "....#..............##......#...",
    "....#........##................",
    "....#.....#....#....##....##...",
    ".#........#......#......#......",
    "....#..........#...............",
    "##..........#......#.....#.....",
    "........#.#..#.#..#.....##.....",
    "..##......#.#.......#.#..#.....",
    ".#.......#......#...........#..",
    "..#.#..#.#..................#..",
    "...#...#...#...##......#.......",
    ".#...##....#...#...#...#.......",
    ".......#.#.......#.............",
    ".#.##.#.....#...........#.##.#.",
    ".#.##.#........#...##..........",
    ".#.....#.....#....#..#.........",
    "...##.............##...........",
    ".#........##.....#.......#...#.",
    "...........#..#..##........##..",
    ".....#..#......................",
    "..#.......#....................",
    ".....#......#....#....#.......#",
    "........#..#.#.....#......#....",
    "..........#..#.....#......#....",
    "..........#####.....#........#.",
    "........#..#...#.#....#......#.",
    ".........#...#....#.#..........",
    "......#....##..........#...#...",
    "#..............###.#.#.........",
    ".#.#............##......#.#..#.",
    "......#........................",
    "...#..#......#.......#....#...#",
    ".......#....##.....#.#......##.",
    "...........#..........#..#.....",
    "...........#..#.....###......#.",
    ".......#....#..##......#.......",
    ".........#.#.#.......#..#...#..",
    ".......#.......##.....##...#...",
    "..............#....#.....#.....",
    "...#....#.....#.#..........##..",
    "###.........#.............#....",
    "...##......#.#........#....#..#",
    "#....###.......#...#.#......##.",
    "....#...##.......#......#.....#",
    ".....#......#..................",
    "#........##....#....#.#........",
    "........#.......###...#........",
    "........#..#.......###.........",
    "..............#......#..#......",
    "#......#.....#....#.#..........",
    ".#......##.#.#.....#...#.#....#",
    ".##...........#..#.##.....#....",
    ".....#.....................#...",
    ".#..#...#...##.#...#...........",
    ".......#.......##..#.#..#......",
    ".......##.....#.....#..........",
    ".................#.............",
    "#........#..#.......##.........",
    "#...#..###.#..#....#.#.###.....",
    "..#.......#.......#.......#....",
    "..............#............##..",
    ".#...#..#...##.........#....#..",
    "#...........#...#..............",
    ".......#.....#......#..#.....#.",
    "..........#......#.............",
    "##.........###..##.#....#..#.#.",
    "..............###..............",
    "#..##.............##.....#.....",
    "....##...................#..#..",
    "....#.....#..............#..#.#",
    "........#........##...#.....##.",
    "#...........#.##..........##...",
    "#......##.....#...............#",
    "..##..#....#.................#.",
    "#.......##.....................",
    "...............#.##..##......#.",
    "..#.##..#.#....#.......##......",
    "......##....#............##....",
    ".#..#..##.....#.##....#........",
    "#.........#..........#...#....#",
    "...#.......#.............#.#.#.",
    "..##............#...##........#",
    ".......#.#.#........#..........",
    ".....#.............#.....#.....",
    ".........#.........#.........#.",
    "#.....#....#.......#...........",
    ".........#....#.............#.#",
    ".##..#.......#...#......#......",
    "....#....#....#........#....#..",
    "............#.......#..#......#",
    ".#............#.##........##...",
    "..#...##...#....#...#.#...#..#.",
    "#...#..........#..##.........#.",
    "..#.........................#.#",
    "...........#.........#..#.##...",
    ".#..................#..#.......",
    "......#......#...........#..#..",
    "...##.....#.....#..#.......#...",
    ".........#.#.......#......#....",
    "...........#................#..",
    ".....#...#..#............##....",
    ".#.......#..#....#..........#..",
    "#.....#..#.....#..##.......##..",
    "...#.......#...#....#...#.#..##",
    "...#...##......#....#....#.....",
    ".......###.#..#.......#......#.",
    "........#.#...#..#..#...#....#.",
    "....#.........##.#.....#.......",
    "....#.........#..##........#...",
    "..#...........#......#....#.##.",
    ".....................#.........",
    "...................##......#..#",
    "......#.#.....##..##..........#",
    "..#.##........#.#.#..........#.",
    ".#.......#...##.#....#....#....",
    "#.#......#..#..#.......#.......",
    ".............#........#.......#",
    "....#...#.....#........#...#...",
    "..#..............##..#.........",
    "..#.................#..#...##..",
    "....#..#...#...................",
    "......#.........##.#..#..#...##",
    "........#..#....#.......#.#.##.",
    ".#...#...........#..........#..",
    "##.....#...#............##...#.",
    ".##.....#...#..................",
    ".#.......####.#..##.##.#......#",
    ".............#...#..#..#.......",
    "...#.##.........#.#....#.......",
    "...........##...##....#....##..",
    "........#......#...#...........",
    "...........#..#...#....#.##....",
    "..##....#..........#....#...#..",
    "#....#.#.#.......#.#...........",
    "......#............##..........",
    "#.#.###..#....#.......#...#....",
    ".#......##..#..#.#.........#..#",
    "..#.........#........#....#....",
    "......##.#.......##....#..#..##",
    ".............#...#............#",
    "......#......#...#.#.#.##.#....",
    "#.#...#.##.....#..............#",
    "..........#.............##.##..",
    "#......#....#...#.#.#.#..#....#",
    "........#........#...#.#......#",
    ".....#...........#.............",
    "...........#....#..........#...",
    "....####...#..##....#.#........",
    ".#......#...#..#...........#...",
    "#......###..#.##.###...........",
    "..#...........#.........#....#.",
    "................#.#....#..#.##.",
    "...................#......#....",
    "....#.#.....#.......#...###.##.",
    ".#........#.#....#...#..#...#..",
    "....#..###.................#..#",
    ".....#.#..#........#......#..#.",
    "....#.....#...............#...#",
    "............##.#.........#..#..",
    ".......#..#..##.#.#...##.......",
    "..#..........##..#..#........#.",
    "..............#..#...#.........",
    "......#.#....#........##.......",
    ".#.....##....#..#...#.......##.",
    "..............#.##.............",
    "#..#..#...##....##.#.....##.#..",
    "..#...###..#.........##........",
    "........##......#.....#..###...",
    ".....#......##.###.............",
    "....#.....#.#..#.#..#..........",
    "....#..#.......#...........#...",
    ".#.............#..#......##....",
    "..#.#......#.#.................",
    ".......#.#.#............#..#...",
    "......###....##............#..#",
    ".........#....#......#.........",
    "..........#...............#..#."
  ]

test_findChar_emptyInput =
  testCase "findChar from an empty input returns Nothing" $
    findChar (10, 10) [] @?= Nothing

test_findChar_overlappingHeight =
  testCase "findChar from an input with overlapping height returns Nothing" $
    findChar (10, 1) ["1234567"] @?= Nothing

test_findChar_overlappingWidhtAndHeight =
  testCase "findChar from an input with overlapping width and height returns Nothing" $
    findChar (10, 3) ["1234567", "1234567", "1234567"] @?= Nothing

test_findChar_overlappingWidht =
  testCase "findChar from an input with overlapping width returns Nothing" $
    findChar (1000, 0) ["1234567", "1234567", "1234567"] @?= Nothing

test_findChar_existingCoordinates =
  testCase "findChar from an input with existing coordinates returns the character" $
    findChar (1, 2) ["1234567", "1234567", "1234567"] @?= Just '2'

test_findChar_existingCoordinates_realInput =
  testCase "findChar from an input with existing coordinates returns the character" $
    findChar (19, 10) input @?= Just '#'

test_hits_0 =
  testCase "hits from empty lines returns 0" $
    hits slope 0 (Just (8, 1)) [] @?= 0
  where
    slope = buildSlope 3 1

test_nextCoordinate_noOverlapping =
  testCase "nextCoordinate in range x and y" $
    nextCoordinate slope (3, 1) input @?= Just (6, 2)
  where
    slope = buildSlope 3 1

test_nextCoordinate_overlappingX =
  testCase "nextCoordinate with an overlapping X" $
    nextCoordinate slope (30, 1) input @?= Just (2, 2)
  where
    slope = buildSlope 3 1

test_hits =
  testCase "hits from real input data" $
    hits slope 0 (Just (3, 1)) input @?= 209
  where
    slope = buildSlope 3 1

test_hits_allSlopes =
  testCase "hits from real input data for all slopes" $
    fmap (\slope -> hits slope 0 (Just (0, 0)) input) allSlopes @?= [58, 209, 58, 64, 35]
